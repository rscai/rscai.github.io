<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">

<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Apply Repository Pattern by Spring Data | Ray’s Blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Apply Repository Pattern by Spring Data" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="We code for compiling." />
<meta property="og:description" content="We code for compiling." />
<meta property="og:site_name" content="Ray’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-16T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Apply Repository Pattern by Spring Data" />
<script type="application/ld+json">
{"description":"We code for compiling.","@type":"BlogPosting","headline":"Apply Repository Pattern by Spring Data","dateModified":"2020-04-16T00:00:00+00:00","datePublished":"2020-04-16T00:00:00+00:00","url":"/2020/04/apply-repository-pattern-by-spring-data","mainEntityOfPage":{"@type":"WebPage","@id":"/2020/04/apply-repository-pattern-by-spring-data"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>Ray's Blog</h1>
        </a>
        <h2>Sr. Developer</h2>

        <section id="downloads">
          
          <a href="" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <small>16 April 2020</small>
<h1>Apply Repository Pattern by Spring Data</h1>

<p class="view">by </p>

<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>We code for compiling.</p>
</div>
<div class="paragraph">
<p>We code for running.</p>
</div>
<div class="paragraph">
<p>We code for changing.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="repository-pattern">Repository Pattern</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Mediates between the domain and data mapping layers using a collection-like interface for accessing domain objects.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Domain Driven Design is domain centric, and domain data persistance (is abstracted as data mapping) is mandatory for almost application.</p>
</div>
<div class="paragraph">
<p>Repository plays as an interface between client code and data mapping layers, hides complexity and isolates changes of data mapping layers from client code.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-3e3cd96a57e5ad61522b0f7dac7d093f.png" alt="Diagram" width="374" height="420">
</div>
</div>
<div class="paragraph">
<p>Through repository, client code could access and persisten entity instances by collection-like and domain-centric interface. Because repository isolates changes of data mapping layers from client code, therefore it is easy to change data mapping layers implemenation. For example, it defines a repository interface and two implementations:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-8759650d078b2465d0e11ea0ecd1fd0a.png" alt="Diagram" width="329" height="205">
</div>
</div>
<div class="paragraph">
<p>When we changed the data mapping layer from JPA to MongoDB, it need not change any client code. Because client code depends on repository interface.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-5e1c65a27b3dcfd6d9d67d0830d5c455.png" alt="Diagram" width="410" height="445">
</div>
<div class="title">Figure 1. JPA data mapping layer</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-164625319346b449b4558c532db883eb.png" alt="Diagram" width="534" height="445">
</div>
<div class="title">Figure 2. MongoDB data mapping layer</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="data-mapper-pattern">Data Mapper Pattern</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In software engineering, the data mapper pattern is an architectural pattern. It was named by Martin Fowler in this 2003 book Patterns of Enterprise Application Architecture. The interface of an object conforming to this pattern would include functions such as Create, Read, Update, and Delete, that operate on objects that represent domain entity types in a data store.</p>
</div>
<div class="paragraph">
<p>A Data Mapper is a Data Access Layer that performs bidirectional transfer of data between a persistent data store (often a relational database) and an in-memory data representation (the domain layer). The goal of the pattern is to keep the in-memory representation and the persistent data store independent of each other and the data mapper itself. The layer is composed of one or more mappers (or Data Access Objects), performing the data transfer. Mapper implementations vary in scope. Generic mappers will handle many different domain entity types, dedicated mappers will handle one or a few.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Data mapper pattern<br>
<cite>https://en.wikipedia.org/wiki/Data_mapper_pattern</cite>
</div>
</div>
<div class="paragraph">
<p>The pattern descibes data access by descriptive approach. It defines elements of in-memory data representation and data store, and maps them. Take Object/Relation Mapping as an example, it defines elements of object represnetation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class</p>
</li>
<li>
<p>object</p>
</li>
<li>
<p>field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and defines elements of Relational database:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>table</p>
</li>
<li>
<p>record</p>
</li>
<li>
<p>column</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and then maps them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>class maps to table</p>
</li>
<li>
<p>object maps to record</p>
</li>
<li>
<p>field maps to column</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>With data mapper pattern, application developer need not consider data access case by case, but describe the mapping of elements of in-memory and data store representations.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="one-repository-per-entity">One Repository per Entity</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Per <strong>Single-responsibility principle</strong>, one repository should only handle one entity.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The single-responsibility principle (SRP) is a computer-programming principle that states that every module or class should have responsiblity over a single part of the functionality provided by the software, and that responsibility should be entirely encapsulated by the class, module or function. All its services should be narrowly aligned with that responsiblity. Robert C. Martin expresses the principle as "A class should have only one reason to change." although, because of confusion around the word "reason" he more recently stated "This principle is about people."</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Single-responsibility principle<br>
<cite>https://en.wikipedia.org/wiki/Single-responsibility_principle</cite>
</div>
</div>
<div class="paragraph">
<p>Keeping one repository per entity could benefit developer:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>make repository small and clean</p>
</li>
<li>
<p>changing data store solution per entity independently</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="spring-data">Spring Data</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Spring Data&#8217;s mission is to provide a familiar and consistent, Spring-based programming model for data access while still retaining the special traits of the underlying data store.</p>
</div>
<div class="paragraph">
<p>It makes it easy to use data access technologies, relational and non-relational databases, map-reduce frameworks, and cloud-based data services. This is an umbrella project which contains many subprojects that are specifiv to a given database. The projects are developed by working together with many of the companies and developers that are behind these exciting technologies.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Spring Data<br>
<cite>https://spring.io/projects/spring-data</cite>
</div>
</div>
<div class="paragraph">
<p>The core of Spring Data is Repository. Repositories of Spring data are organized in interface/abstract class/implementation class pattern. Take Spring Data JPA as an example, it offers base interface <code>JpaRepository</code> and abstract class <code>SimpleJpaRepository</code> (<code>SimpleJpaRepository</code> technically is not declared as <code>abstract</code>, but it logically is used as abstract class). Application developer only needs to declare entity-specific repository interface, Spring Data will generate implementation class.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-556d5c5ad346c2fea70001cc20f79636.png" alt="Diagram" width="453" height="306">
</div>
<div class="title">Figure 3. Spring Data Repository</div>
</div>
<div class="sect2">
<h3 id="predefined-repository-interface">Predefined Repository Interface</h3>
<div class="paragraph">
<p>Spring Data consists of core module <strong>Spring Data Commons</strong> and other data store specific modules. Spring Data is repository-centric. Spring Data Commons module defines a few common repository interfaces, other modules define more data store specific repository interfaces.</p>
</div>
<div class="paragraph">
<p>Spring Data Commons defines repository interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Repository</code>, is a base and empty repository, does not declare any methods.</p>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-6579e94f4b8011380ea1e54a90443f4e.png" alt="Diagram" width="150" height="68">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>CrudReposority</code>, declares simple Create/Read/Update/Delete methods.</p>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-0e062e9ee3e91d66bc58ec6bd26d7288.png" alt="Diagram" width="311" height="319">
</div>
</div>
</li>
<li>
<p><code>PagingAndSortingRepository</code>, inherit simple Create/Read/Update/Delete methods and plus pagination and sorting support.</p>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-e4613e0f134439dfb49a0440c772c06a.png" alt="Diagram" width="261" height="204">
</div>
</div>
</li>
<li>
<p><code>ReactiveCrudRepository</code>, TBD</p>
</li>
<li>
<p><code>ReactiveSortingRepository</code>, TBD</p>
</li>
<li>
<p><code>RevisionRepository</code>, TBD</p>
<div class="imageblock">
<div class="content">
<img src="/assets/generated_diagrams/diag-ee9b471b48aad52f5b1bff900a09cb89.png" alt="Diagram" width="400" height="230">
</div>
</div>
</li>
<li>
<p><code>RxJava2CrudRepository</code>, TBD</p>
</li>
<li>
<p><code>RxJava2SortingRepository</code>, TBD</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="deriving-the-query-from-the-method-name">Deriving the Query from the Method Name</h3>
<div class="paragraph">
<p>TBD</p>
</div>
</div>
<div class="sect2">
<h3 id="using-a-manually-defined-query">Using a Manually Defined Query</h3>
<div class="paragraph">
<p>TBD</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="reference">Reference</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Data_mapper_pattern">Data mapper pattern</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Single-responsibility_principle">Single-responsibility principle</a></p>
</li>
</ul>
</div>
</div>
</div>


  <small>tags: <em>spring-boot</em> - <em>spring</em> - <em>spring-data</em> - <em>repository-pattern</em></small>


      </section>
    </div>

    
  </body>
</html>
