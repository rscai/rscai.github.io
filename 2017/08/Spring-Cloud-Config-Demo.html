<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8" />
  <!-- multi-device width -->
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <!-- site description -->
  
  <meta content="Summary" name="description" />
  <!-- referer for 3rd-part images-->
  <meta content="no-referrer" name="referrer" />
  <!-- title -->
  <title>
    
    Spring Cloud Config Demo
    
  </title>
  <!-- icon -->
  <link href="https://rscai.github.io/assets/img/favicon.ico?" rel="shortcut icon bookmark" type="image/x-icon" />
  <!-- main stylesheet -->
  <link rel="stylesheet" href="https://rscai.github.io/assets/css/main.css" type="text/css" />
  <!-- fa 5.9.0 -->
  <link rel="stylesheet" href="https://rscai.github.io/assets/css/fa.min.css" type="text/css" />
  <!-- rouge theme-->
  <link rel="stylesheet" href="https://rscai.github.io/assets/css/rouge-bg.css" />
  <!-- mathjax 2.7.5 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
  </head>
  <body class="page">
    <!-- disable background animations -->

    <div class="container" id="ctner">
      <div class="header">
    <nav class="nav_bar">
        <ul>
            <!-- left header -->
            <li
                class="li_left">
                <!-- home -->
                
                    <a class="header_btn" href="https://rscai.github.io">
                        <i class="fa fa-home">
                            
                                <p class="btn_text">Home</p>
                            
                        </i>
                    </a>
                
                <!-- email -->
                
                    <a class="header_btn" href="mailto://">
                        <i class="fa fa-envelope-square">
                            
                                <p class="btn_text">Email</p>
                            
                        </i>
                    </a>
                
                <!-- github -->
                
                    <a class="header_btn" href="https://github.com/">
                        <i class="fa fa-github">
                            
                                <p class="btn_text">Github</p>
                            
                        </i>
                    </a>
                
                <!-- maximize -->
                
                    <a class="header_btn" id="mxmz_btn" onclick="toggle_maximize()">
                        <i class="fa fa-window-maximize">
                            
                                <p class="btn_text" id="mxmz_text">Maximize</p>
                            
                        </i>
                    </a>
                
                <!-- access token -->
                
            </li>
            <!-- right header -->
            <span
                class="span_right">
                <!-- popup table of content -->
                
                    <a class="header_btn" onclick="scroll_percentage(-0.88)">
                        <i class="fa fa-backward">
                            
                                <p class="btn_text">Prev</p>
                            
                        </i>
                    </a>
                    <!-- scroll down -->
                    <a class="header_btn" onclick="scroll_percentage(0.88)">
                        <i class="fa fa-forward">
                            
                                <p class="btn_text">Next</p>
                            
                        </i>
                    </a>
                    <!-- popup table of content -->
                    <a class="header_btn popup_btn" onclick="toggle_toc()">
                        <i class="fa fa-bars">
                            
                                <p class="btn_text">Content</p>
                            
                        </i>
                    </a>
                
            </span>
        </ul>
    </nav>
    <hr/>
</div>
<!-- table of content -->

    <div class="div_toc toc" id="popup_toc">
    
    <!-- generate toc -->
    <ul id="ul_toc" class="ul_toc">
  <li><a href="#summary">Summary</a></li>
  <li><a href="#deployment">Deployment</a></li>
  <li><a href="#rest-api">REST API</a></li>
  <li><a href="#application-read-configuration">Application Read Configuration</a></li>
  <li><a href="#change-configuration">Change Configuration</a></li>
  <li><a href="#promote-configuration-changes">Promote Configuration Changes</a></li>
</ul>
    </div>
    <!-- toggle toc -->
    <script>
    function toggle_toc() {
        var popup = document.getElementById("popup_toc");
        popup.classList.toggle("show");
    }
    </script>
    <!-- scroll page -->
        <script>
    function scroll_percentage(mtpler) {
        document
        .getElementById("div_atcl")
        .scrollBy(0, window.innerHeight * mtpler);
    }
    </script>

<!-- toggle maximize -->

<script>
  var ctner_state = 0;
  var ctner = document.getElementById("ctner");
  function toggle_maximize() {
    if (ctner_state == 0) {
      ctner.style.width = "100%";
      ctner.style.height = "100%";
      ctner.style.top = "0";
      ctner.style.maxWidth = "100%";
      if (document.getElementById("mxmz_text")) {
        document.getElementById("mxmz_text").innerHTML = "Restore";
      }
      ctner_state = 1;
    } else if (ctner_state == 1) {
      ctner.style.width = "84%";
      ctner.style.height = "97%";
      ctner.style.top = "2%";
      ctner.style.maxWidth = "1240px";
      if (document.getElementById("mxmz_text")) {
        document.getElementById("mxmz_text").innerHTML = "Maximize";
      }
      ctner_state = 0;
    }
  }
</script>

<!-- encrypt and decrypt -->


      <div class="div_article" id="div_atcl">       
        <article id="main_atcl" itemscope itemtype="http://schema.org/BlogPosting">
          <h1>
  Spring Cloud Config Demo
</h1>
<div class="post_info">
  <!-- author -->
  
  <!-- date -->
  
  <span>
    <i class="fa fa-calendar"></i>
    Aug 20, 2017
  </span>
  
  <!-- category -->
  
</div>
<!-- abstract -->
<div class="abstract">
  
</div>

<h2 id="summary">Summary</h2>

<ul>
  <li>Centralizing configuration</li>
  <li>Decoupling changes/deployment of code and configuration</li>
  <li>Control and audit configuration changes</li>
  <li>Configuration as Code</li>
</ul>

<h2 id="deployment">Deployment</h2>

<pre><code class="language-puml">@startuml
left to right direction
node node1 {
    component app_a_instance_1
    component app_b_instance_1
}
node node2 {
    component app_a_instance_2
    component app_b_instance_2
}



[app_a_instance_1] ..&gt; REST: GET
[app_b_instance_1] ..&gt; REST: GET
[app_a_instance_2] ..&gt; REST: GET
[app_b_instance_2] ..&gt; REST: GET

node node3 {
    REST &lt;-- [config_server]: provided
}
database git_repo
git_repo &lt;. config_server: read
@enduml
</code></pre>

<p>Configuration is wrote in property and yaml files, and stored in Git repository. Config server is reading content of Git repository, and expose content as read only REST API. Application read specific configuration by request corresponding URL to config server.</p>

<h2 id="rest-api">REST API</h2>

<p>Expose two types of resources:</p>

<ol>
  <li>Profile</li>
  <li>File</li>
</ol>

<p><strong>Profile</strong></p>

<table>
  <thead>
    <tr>
      <th>HTTP Method</th>
      <th>URI Pattern</th>
      <th>Response MIME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET</td>
      <td>/{application-name}/{profile-name}</td>
      <td>application/json</td>
    </tr>
  </tbody>
</table>

<p><strong>File</strong></p>

<table>
  <thead>
    <tr>
      <th>HTTP Method</th>
      <th>URI Pattern</th>
      <th>Response MIME</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>GET</td>
      <td>/{application-name}-{profile-name}.{suffix}</td>
      <td>text/plain</td>
    </tr>
  </tbody>
</table>

<h2 id="application-read-configuration">Application Read Configuration</h2>

<pre><code class="language-puml">@startuml
participant app_a_instance_1
participant config_server
database git_repo

activate config_server
activate app_a_instance_1

app_a_instance_1 -&gt; config_server: GET(/{application-name}/{profile-name})
config_server -&gt; git_repo: pull
app_a_instance_1 &lt;-- config_server: json
note left
{  
   "name":"app1",
   "profiles":[  
      "default"
   ],
   "label":null,
   "version":"40215a6f5b25f2315a4d2fa3f62f67d031aacbff",
   "state":null,
   "propertySources":[  
      {  
         "name":"git@github.com:rscai/config-repo-dev.git/app1.yml",
         "source":{  
            "datasource.driverClass":"com.oracle.jdbc.Driver",
            "datasource.url":"jdbc:thin://hostname:port/serviceName",
            "pool.max":10,
            "pool.min":2
         }
      }
   ]
}
end note
@enduml
</code></pre>

<h2 id="change-configuration">Change Configuration</h2>

<pre><code class="language-puml">@startuml
|Maker|
start
:create feature branch from master;
:commit changes to feature branch;
:create pull request from feature branch to master;
|Checker|
:review pull request;
if (approve?) then (yes)
    :merge into master;
else (no)
    :reject;
endif
end
@enduml
</code></pre>

<p>Config server is only reading master branch. <br />
Maker must not commit configuration changes to master branch directly. Instead, Maker should create a feature branch from master branch, then commit configuration changes to the feature branch.<br />
After all configuration changes is ready on feature branch, then maker create a pull request from feature branch to master branch.<br />
Checker review the pull request and decide if accept these changes.</p>

<h2 id="promote-configuration-changes">Promote Configuration Changes</h2>

<p>All code changes must go through mature verification process. Same for configuration changes.</p>

<pre><code class="language-puml">@startuml
database dev_repo
database sit_repo
database uat_repo
database prod_repo

[dev_repo] .&gt; [sit_repo]: pull request
[sit_repo] .&gt; [uat_repo]: pull request
[uat_repo] .&gt; [prod_repo]: pull request
@enduml
</code></pre>

<p>Maker create pull request from lower environment configuration repository (master branch) to higher environment configuration repository (master branch).<br />
Checker review pull request and decide if accept changes.</p>


          

        </article>
          
      </div>
    </div>
  </body>
</html>
